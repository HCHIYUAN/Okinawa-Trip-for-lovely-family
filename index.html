<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Â•≥ÁéãÁöÑÊ≤ñÁπ©ÁîüÊó•‰πãÊóÖ</title>

    <!-- PWA/Icon Ë®≠ÂÆö -->
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Ê≤ñÁπ©‰πãÊóÖ">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#fff1f2">

    <!-- ÂºïÂÖ• React Âíå Tailwind -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        rose: { 50: '#fff1f2', 100: '#ffe4e6', 200: '#fecdd3', 300: '#fda4af', 400: '#fb7185', 500: '#f43f5e', 600: '#e11d48' },
                        gold: { 400: '#fbbf24', 500: '#f59e0b' }
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'shimmer': 'shimmer 2.5s linear infinite',
                        'fadeIn': 'fadeIn 0.3s ease-out forwards',
                        'slideUp': 'slideUp 0.3s ease-out forwards',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' },
                        },
                        shimmer: {
                            '0%': { backgroundPosition: '-200% 0' },
                            '100%': { backgroundPosition: '200% 0' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500;700&display=swap');
        
        html { overscroll-behavior-y: none; }
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            -webkit-tap-highlight-color: transparent; 
            -webkit-user-select: none; user-select: none;
            min-height: 100vh; background-color: #fff1f2;
        }
        input, textarea, select { -webkit-user-select: text; user-select: text; }
        .font-script { font-family: 'Great Vibes', cursive; }
        .font-cute { font-family: 'Zen Maru Gothic', sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .custom-checkbox:checked + div { background-color: #f43f5e; border-color: #f43f5e; }
        .custom-checkbox:checked + div svg { display: block; }
        .safe-top { padding-top: env(safe-area-inset-top); }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .modal-overlay { background-color: rgba(0, 0, 0, 0.5); backdrop-filter: blur(4px); }
    </style>
</head>
<body class="bg-rose-50 text-gray-800 antialiased selection:bg-rose-200">
    <div id="root"></div>

    <script type="text/babel">
        // --- ÂúñÊ®ôÁµÑ‰ª∂Â∫´ ---
        const Icon = ({ path, size = 24, className = "", ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>
                {path}
            </svg>
        );

        const Icons = {
            Heart: (p) => <Icon {...p} path={<path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>} />,
            Coffee: (p) => <Icon {...p} path={<><path d="M18 8h1a4 4 0 0 1 0 8h-1"></path><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path><line x1="6" y1="1" x2="6" y2="4"></line><line x1="10" y1="1" x2="10" y2="4"></line><line x1="14" y1="1" x2="14" y2="4"></line></>} />,
            Utensils: (p) => <Icon {...p} path={<><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"></path><path d="M7 2v20"></path><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"></path></>} />,
            Baby: (p) => <Icon {...p} path={<><circle cx="12" cy="5" r="3"></circle><path d="M9 12h6"></path><path d="M14.5 18a2.5 2.5 0 0 0-5 0"></path><path d="M6 10v4a4 4 0 0 0 4 4h4a4 4 0 0 0 4-4v-4"></path></>} />,
            MapPin: (p) => <Icon {...p} path={<><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></>} />,
            ShoppingBag: (p) => <Icon {...p} path={<><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></>} />,
            Gift: (p) => <Icon {...p} path={<><polyline points="20 12 20 22 4 22 4 12"></polyline><rect x="2" y="7" width="20" height="5"></rect><line x1="12" y1="22" x2="12" y2="7"></line><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"></path><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"></path></>} />,
            Music: (p) => <Icon {...p} path={<><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></>} />,
            Star: (p) => <Icon {...p} path={<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>} />,
            Fish: (p) => <Icon {...p} path={<path d="M20.3 19.3L15.4 15.4C15.1 15.1 14.7 15 14.2 15H14C12.9 15 12 14.1 12 13V12C12 10.9 12.9 10 14 10H14.2C14.7 10 15.1 9.9 15.4 9.6L20.3 5.7C20.9 5.2 22 5.5 22 6.4V18.7C22 19.5 20.9 19.9 20.3 19.3ZM6 13C3.8 13 2 11.2 2 9C2 6.8 3.8 5 6 5C8.2 5 10 6.8 10 9C10 11.2 8.2 13 6 13Z"></path>} />,
            Car: (p) => <Icon {...p} path={<path d="M14 16H9m10-9h-4l-1-2H10L9 7H5a2 2 0 0 0-2 2v6h2m14 0h2v-6a2 2 0 0 0-2-2ZM7 16a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm14 0a2 2 0 1 1-4 0 2 2 0 0 1 4 0Z"></path>} />,
            Cake: (p) => <Icon {...p} path={<><path d="M20 21v-8a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v8"></path><path d="M4 16s.5-1 2-1 2.5 2 4 2 2.5-2 4-2 2.5 2 4 2 2-1 2-1"></path><path d="M2 21h20"></path><path d="M7 8v2"></path><path d="M12 8v2"></path><path d="M17 8v2"></path><path d="M7 4h.01"></path><path d="M12 4h.01"></path><path d="M17 4h.01"></path></>} />,
            Nav: (p) => <Icon {...p} path={<polygon points="3 11 22 2 13 21 11 13 3 11"></polygon>} />,
            Plane: (p) => <Icon {...p} path={<path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>} />,
            List: (p) => <Icon {...p} path={<><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></>} />,
            Calendar: (p) => <Icon {...p} path={<><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></>} />,
            CheckSquare: (p) => <Icon {...p} path={<polyline points="9 11 12 14 22 4"></polyline>} />,
            Trash: (p) => <Icon {...p} path={<><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></>} />,
            Edit: (p) => <Icon {...p} path={<><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></>} />,
            Plus: (p) => <Icon {...p} path={<><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></>} />,
            X: (p) => <Icon {...p} path={<><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></>} />,
            Save: (p) => <Icon {...p} path={<polyline points="20 6 9 17 4 12"></polyline>} />,
            Settings: (p) => <Icon {...p} path={<circle cx="12" cy="12" r="3"></circle>} />,
            ClipboardCheck: (p) => <Icon {...p} path={<><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect><path d="M9 14l2 2 4-4"></path></>} />,
        };

        const iconKeys = ['Plane', 'Car', 'Star', 'Utensils', 'Coffee', 'Baby', 'ShoppingBag', 'Gift', 'MapPin', 'Fish', 'Heart', 'Cake', 'Music'];

        // --- ËèØÈ∫óÈñãÂ†¥ÂãïÁï´ ---
        const WelcomeScreen = ({ onStart }) => {
            const [showBtn, setShowBtn] = React.useState(false);
            React.useEffect(() => { const timer = setTimeout(() => setShowBtn(true), 3000); return () => clearTimeout(timer); }, []);
            return (
                <div className="fixed inset-0 z-50 bg-gradient-to-b from-rose-100 via-pink-50 to-white text-gray-800 flex flex-col items-center justify-center overflow-hidden">
                    <div className="absolute top-0 left-0 w-full h-full opacity-30 pointer-events-none">
                        <div className="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-pink-300 rounded-full blur-[100px] animate-pulse-slow"></div>
                        <div className="absolute bottom-[-10%] right-[-10%] w-[60%] h-[60%] bg-rose-200 rounded-full blur-[120px] animate-pulse-slow"></div>
                    </div>
                    <div className="z-10 text-center space-y-6 px-6 max-w-lg w-full">
                        <div className="opacity-0 animate-[fadeIn_1.5s_ease-out_forwards]"><p className="text-3xl font-script text-rose-500 tracking-wider drop-shadow-sm">To My Dearest Queen</p></div>
                        <div className="opacity-0 animate-[scaleIn_1.5s_ease-out_0.8s_forwards] relative">
                            <h1 className="text-5xl md:text-7xl font-script bg-clip-text text-transparent bg-gradient-to-r from-rose-500 via-pink-500 to-rose-400 drop-shadow-sm py-2 leading-tight">Happy Birthday</h1>
                            <div className="absolute -top-10 -right-4 text-yellow-400 animate-bounce delay-700"><Icons.Star size={32} fill="currentColor" /></div>
                        </div>
                        <div className="opacity-0 animate-[slideUp_1.5s_ease-out_1.5s_forwards]">
                            <div className="inline-block border-y border-rose-300/50 py-3 px-8 mt-4 backdrop-blur-sm bg-white/30 rounded-full"><p className="text-gray-600 font-cute text-lg tracking-[0.2em] uppercase">Okinawa Luxury Trip</p></div>
                        </div>
                        <div className={`transition-all duration-1000 transform ${showBtn ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-10'}`}>
                            <button onClick={onStart} className="mt-12 relative group px-12 py-5 bg-gradient-to-r from-rose-400 to-pink-500 rounded-full text-white font-bold shadow-[0_10px_30px_rgba(244,63,94,0.4)] hover:shadow-[0_15px_40px_rgba(244,63,94,0.6)] hover:-translate-y-1 transition-all duration-300 overflow-hidden">
                                <div className="absolute inset-0 w-full h-full bg-gradient-to-r from-transparent via-white/30 to-transparent -translate-x-full group-hover:animate-shimmer"></div>
                                <span className="flex items-center gap-3 text-xl font-cute tracking-widest relative z-10">ÈñãÂïüÂ§¢ÂπªÊóÖÁ®ã <Icons.Gift size={22} className="group-hover:rotate-12 transition-transform" /></span>
                            </button>
                        </div>
                    </div>
                    <style>{`@keyframes fadeIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } } @keyframes scaleIn { from { opacity: 0; transform: scale(0.9); filter: blur(10px); } to { opacity: 1; transform: scale(1); filter: blur(0); } } @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }`}</style>
                </div>
            );
        };

        // --- Á∑®ËºØË°åÁ®ã Modal ---
        const EditModal = ({ isOpen, onClose, onSave, item, isNew }) => {
            const [formData, setFormData] = React.useState({
                time: '', activity: '', note: '', loc: '', iconName: 'Star'
            });

            React.useEffect(() => {
                if (isOpen) {
                    if (item) {
                        setFormData({
                            time: item.time || '',
                            activity: item.activity || '',
                            note: item.note || '',
                            loc: item.loc || '',
                            iconName: item.iconName || 'Star'
                        });
                    } else {
                        setFormData({ time: '', activity: '', note: '', loc: '', iconName: 'Star' });
                    }
                }
            }, [isOpen, item]);

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
                    <div className="absolute inset-0 modal-overlay" onClick={onClose}></div>
                    <div className="bg-white rounded-[32px] w-full max-w-sm p-6 relative z-10 shadow-2xl animate-slideUp">
                        <h3 className="text-xl font-bold font-cute mb-4 text-center">{isNew ? 'Êñ∞Â¢ûË°åÁ®ã' : 'Á∑®ËºØË°åÁ®ã'}</h3>
                        
                        <div className="space-y-4 max-h-[60vh] overflow-y-auto no-scrollbar">
                            <div>
                                <label className="block text-xs font-bold text-gray-500 mb-1">ÊôÇÈñì</label>
                                <input type="time" className="w-full bg-gray-50 rounded-xl p-3 outline-none focus:ring-2 focus:ring-rose-200" value={formData.time} onChange={e => setFormData({...formData, time: e.target.value})} />
                            </div>
                            <div>
                                <label className="block text-xs font-bold text-gray-500 mb-1">Ê¥ªÂãïÂêçÁ®±</label>
                                <input type="text" className="w-full bg-gray-50 rounded-xl p-3 outline-none focus:ring-2 focus:ring-rose-200" placeholder="‰æãÂ¶ÇÔºöÂêÉÁáíËÇâ" value={formData.activity} onChange={e => setFormData({...formData, activity: e.target.value})} />
                            </div>
                             <div>
                                <label className="block text-xs font-bold text-gray-500 mb-1">Â∞éËà™Âú∞Èªû (Ëº∏ÂÖ•Ëá™ÂãïÁî¢ÁîüÊåâÈàï)</label>
                                <input type="text" className="w-full bg-gray-50 rounded-xl p-3 outline-none focus:ring-2 focus:ring-rose-200" placeholder="‰æãÂ¶ÇÔºöÁæéÂúãÊùë" value={formData.loc} onChange={e => setFormData({...formData, loc: e.target.value})} />
                            </div>
                            <div>
                                <label className="block text-xs font-bold text-gray-500 mb-1">ÂúñÁ§∫</label>
                                <div className="flex gap-2 overflow-x-auto pb-2 no-scrollbar">
                                    {iconKeys.map(key => {
                                        const Ico = Icons[key];
                                        return (
                                            <button key={key} onClick={() => setFormData({...formData, iconName: key})} className={`shrink-0 w-10 h-10 rounded-full flex items-center justify-center border-2 transition-all ${formData.iconName === key ? 'border-rose-500 bg-rose-50 text-rose-500' : 'border-gray-100 text-gray-400'}`}>
                                                <Ico size={20} />
                                            </button>
                                        )
                                    })}
                                </div>
                            </div>
                            <div>
                                <label className="block text-xs font-bold text-gray-500 mb-1">ÂÇôË®ª</label>
                                <textarea className="w-full bg-gray-50 rounded-xl p-3 outline-none focus:ring-2 focus:ring-rose-200 h-20" placeholder="ÂØ´Èªû‰ªÄÈ∫º..." value={formData.note} onChange={e => setFormData({...formData, note: e.target.value})}></textarea>
                            </div>
                        </div>

                        <div className="flex gap-3 mt-6">
                            <button onClick={onClose} className="flex-1 py-3 rounded-xl bg-gray-100 text-gray-500 font-bold hover:bg-gray-200 transition-colors">ÂèñÊ∂à</button>
                            <button onClick={() => onSave(formData)} className="flex-1 py-3 rounded-xl bg-rose-500 text-white font-bold shadow-lg shadow-rose-200 hover:bg-rose-600 transition-colors">ÂÑ≤Â≠ò</button>
                        </div>
                    </div>
                </div>
            )
        };

        // --- Ê™¢Êü•Ê∏ÖÂñÆÁµÑ‰ª∂ ---
        const ChecklistView = ({ checklist, onToggleItem, onAddItem, onDeleteItem, onEditItem, title="Ê∫ñÂÇôÈÄ≤Â∫¶" }) => {
            const [newItems, setNewItems] = React.useState({});
            const [editingItem, setEditingItem] = React.useState(null);

            const calculateProgress = () => {
                let total = 0, checked = 0;
                Object.values(checklist).forEach(category => {
                    category.items.forEach(item => {
                        total++;
                        if (item.checked) checked++;
                    });
                });
                return total === 0 ? 0 : Math.round((checked / total) * 100);
            };

            const progress = calculateProgress();
            const handleAddItem = (key) => {
                if (newItems[key]?.trim()) {
                    onAddItem(key, newItems[key].trim());
                    setNewItems(prev => ({ ...prev, [key]: '' }));
                }
            };

            return (
                <div className="px-4 pb-24 animate-fadeIn">
                    <div className="bg-white rounded-3xl p-6 shadow-lg shadow-pink-100/50 mb-6 sticky top-4 z-10 border border-pink-50">
                        <div className="flex justify-between items-end mb-2">
                            <h2 className="text-xl font-bold text-gray-800 font-cute">{title}</h2>
                            <span className="text-2xl font-bold text-rose-500 font-script">{progress}%</span>
                        </div>
                        <div className="w-full bg-gray-100 rounded-full h-3 overflow-hidden">
                            <div className="bg-gradient-to-r from-rose-400 to-pink-500 h-3 rounded-full transition-all duration-1000 ease-out" style={{ width: `${progress}%` }}></div>
                        </div>
                    </div>

                    <div className="space-y-6">
                        {Object.entries(checklist).map(([key, category]) => {
                             const CatIcon = Icons[category.iconName] || Icons.List;
                             return (
                                <div key={key} className="bg-white rounded-3xl overflow-hidden shadow-sm border border-pink-50">
                                    <div className={`p-4 ${category.headerColor} flex items-center gap-3`}>
                                        <div className="p-2 bg-white/30 rounded-full text-white backdrop-blur-sm"><CatIcon size={20} /></div>
                                        <h3 className="font-bold text-white text-lg tracking-wide flex-1">{category.title}</h3>
                                    </div>
                                    <div className="p-2 space-y-1">
                                        {category.items.map((item, index) => (
                                            <div key={index} className="flex items-center gap-2 p-2 rounded-xl hover:bg-gray-50 transition-colors group relative">
                                                {editingItem && editingItem.catKey === key && editingItem.index === index ? (
                                                    <div className="flex items-center gap-2 w-full animate-fadeIn">
                                                        <input type="text" value={editingItem.text} onChange={(e) => setEditingItem({...editingItem, text: e.target.value})} className="flex-1 border-b-2 border-rose-400 px-2 py-1 outline-none text-gray-700 bg-transparent" autoFocus />
                                                        <button onClick={() => { if(editingItem.text.trim()) { onEditItem(key, index, editingItem.text.trim()); setEditingItem(null); } }} className="p-2 text-green-500"><Icons.Save size={18} /></button>
                                                    </div>
                                                ) : (
                                                    <>
                                                        <label className="flex items-center gap-3 flex-1 cursor-pointer">
                                                            <div className="relative flex items-center shrink-0">
                                                                <input type="checkbox" className="peer sr-only custom-checkbox" checked={item.checked} onChange={() => onToggleItem(key, index)} />
                                                                <div className="w-6 h-6 border-2 border-gray-300 rounded-lg peer-checked:bg-rose-500 peer-checked:border-rose-500 transition-all flex items-center justify-center">
                                                                    <svg className="w-4 h-4 text-white hidden pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="3" d="M5 13l4 4L19 7"></path></svg>
                                                                </div>
                                                            </div>
                                                            <span className={`text-gray-700 font-medium transition-all break-all ${item.checked ? 'line-through text-gray-400' : ''}`}>{item.text}</span>
                                                        </label>
                                                        <div className="flex items-center opacity-0 group-hover:opacity-100 transition-opacity">
                                                            <button onClick={() => setEditingItem({ catKey: key, index, text: item.text })} className="p-2 text-gray-400 hover:text-blue-500"><Icons.Edit size={16} /></button>
                                                            <button onClick={() => onDeleteItem(key, index)} className="p-2 text-gray-400 hover:text-red-500"><Icons.Trash size={16} /></button>
                                                        </div>
                                                    </>
                                                )}
                                            </div>
                                        ))}
                                        <div className="mt-2 pt-2 border-t border-gray-100 px-2 pb-2 flex items-center gap-2">
                                            <input type="text" placeholder="Êñ∞Â¢ûÈ†ÖÁõÆ..." className="bg-transparent outline-none flex-1 text-sm text-gray-600" value={newItems[key] || ''} onChange={(e) => setNewItems({...newItems, [key]: e.target.value})} onKeyDown={(e) => e.key === 'Enter' && handleAddItem(key)} />
                                            <button onClick={() => handleAddItem(key)} disabled={!newItems[key]} className={`p-1 rounded-full ${newItems[key] ? 'text-rose-500' : 'text-gray-300'}`}><Icons.Plus size={18} /></button>
                                        </div>
                                    </div>
                                </div>
                             )
                        })}
                    </div>
                    <div className="h-20"></div>
                </div>
            );
        };

        // --- ‰∏ªÁ®ãÂºè ---
        const ItineraryApp = () => {
            const [showIntro, setShowIntro] = React.useState(true);
            const [activeTab, setActiveTab] = React.useState('day1');
            const [view, setView] = React.useState('itinerary');
            const [isEditMode, setIsEditMode] = React.useState(false);
            const [modalConfig, setModalConfig] = React.useState({ isOpen: false, isNew: false, dayKey: null, itemIndex: null, item: null });

            // ÂàùÂßãË≥áÊñô
            const initialItinerary = {
                day1: {
                    date: '12/23 (‰∏Ä)',
                    title: 'ÂïüÁ®ãËàáËÅñË™ïÂàùÂ§ú',
                    highlight: 'ËèØËà™Áõ¥È£õ & ÁæéÂúãÊùë',
                    details: [
                        { time: '15:50', activity: 'È£õÊ©üËµ∑È£õ (CI132)', iconName: 'Plane', note: 'È´òÈõÑÂá∫ÁôºÔºå18:30 ÊäµÈÅîÈÇ£Èú∏', loc: '' },
                        { time: '19:00', activity: 'ÂèñËªäÔºöËá®Á©∫Ë±êÂ¥éÁáüÊ•≠ÊâÄ', iconName: 'Car', note: 'Ë®òÂæóÂéªÂúãÂÖßÁ∑ö 10-A Êê≠Êé•ÈßÅËªä„ÄÇ‰øùÈö™Â∑≤‰øùÂÖ®Èö™„ÄÇ', loc: 'OTS Ëá®Á©∫Ë±êÂ¥éÁáüÊ•≠ÊâÄ' },
                        { time: '20:30', activity: 'ÂÖ•‰Ωè Vessel Hotel', iconName: 'Star', note: 'Annex Ë±™ËèØÊµ∑ÊôØÊàøÔºÅCheck-in ‰ºëÊÅØ', loc: 'Vessel Hotel Campana Okinawa' },
                        { time: '21:00', activity: 'ËºïÈ¨ÜÊôöÈ§ê & Êï£Ê≠•', iconName: 'Utensils', note: 'A&W Êº¢Â†°ÔºåÊï£Ê≠•Áúã Depot Island ËÅñË™ïÁáàÈ£æ', loc: 'American Village Okinawa' }
                    ]
                },
                day2: {
                    date: '12/24 (‰∫å)',
                    title: 'Âπ≥ÂÆâÂ§úÔºöË¶™Â≠êËàáÂ§ßÈ§ê',
                    highlight: 'ÂÖíÁ´•ÁéãÂúã & Â∏åÁàæÈ†ì',
                    details: [
                        { time: '09:00', activity: 'È£ØÂ∫óÊó©È§ê', iconName: 'Coffee', note: '‰∫´Áî®Ë±êÂØåÂú®Âú∞ÊñôÁêÜ', loc: 'Vessel Hotel Campana Okinawa' },
                        { time: '09:40', activity: 'Ê≤ñÁπ©ÂÖíÁ´•ÁéãÂúã', iconName: 'Baby', note: 'È§µÂãïÁâ©„ÄÅÁúãÂ§ßË±°ÔºåÂ•≥ÂÖíÊîæÈõªÂ§©Â†Ç', loc: 'Okinawa Zoo & Museum' },
                        { time: '12:30', activity: 'Aeon Rycom', iconName: 'ShoppingBag', note: 'ÂçàÈ§êËàáÈÄõË°óÔºå‰∏çÁúãÈ´òÁàæÂ§´ÔºåÂ∞àÂøÉÈô™ÂÆ∂‰∫∫', loc: 'AEON MALL Okinawa Rycom' },
                        { time: '18:30', activity: 'Â∏åÁàæÈ†ìËá™Âä©ÊôöÈ§ê', iconName: 'Gift', note: 'ËÅñË™ïÂ§ßÈ§êÔºÅ‰∫´Áî®Ë±êÂØåÂ§öÊ®£ÁöÑËá™Âä©ÊñôÁêÜÔºåÊÖ∂Á•ùÁæéÂ•ΩÂπ≥ÂÆâÂ§ú„ÄÇ', loc: 'Hilton Okinawa Chatan Resort' }
                    ]
                },
                day3: {
                    date: '12/25 (‰∏â)',
                    title: 'ËÅñË™ïÁØÄÔºöÂåóÈÉ®ÂÖúÈ¢®',
                    highlight: 'ÈØ®ÈØäÈ§µÈ£üÁßÄ & ÂÆÆÈáåÈ∫µ',
                    details: [
                        { time: '11:00', activity: 'Ë®±Áî∞‰ºëÊÅØÁ´ô', iconName: 'MapPin', note: '‰∏≠ÈÄî‰ºëÊÅØÔºåË≤∑ÂÑ™ÊÉ†Á•®', loc: 'Kyoda Roadside Station' },
                        { time: '12:00', activity: 'ÂÆÆÈáåÈ∫µ', iconName: 'Utensils', note: 'ÂêçË≠∑Âú®Âú∞ÁæéÈ£üÔºåÊ¶ªÊ¶ªÁ±≥Â∫ß‰Ωç', loc: 'Miyazato Soba' },
                        { time: '15:00', activity: 'ÁæéÈ∫óÊµ∑Ê∞¥ÊóèÈ§®', iconName: 'Fish', note: 'ÈªëÊΩÆ‰πãÊµ∑È§µÈ£üÁßÄ (ÂøÖÁúã)', loc: 'Okinawa Churaumi Aquarium' },
                        { time: '18:00', activity: 'Aeon Nago ÊôöÈ§ê', iconName: 'ShoppingBag', note: 'ËºïÈ¨ÜÂêÉÊôöÈ§êÂÜçÂõûÈ£ØÂ∫ó', loc: 'AEON Nago' }
                    ]
                },
                day4: {
                    date: '12/26 (Âõõ)',
                    title: 'Â•≥ÁéãÁöÑÊÖ¢Ê¥ªÊó•',
                    highlight: 'Ê∞¥Âúì & ÁêâÁêÉ‰πãÁâõ',
                    details: [
                        { time: '10:30', activity: 'Ê∞¥ÂúìÈ∫µÂåÖ (Suien)', iconName: 'Heart', note: 'Á´•Ë©±Ê£ÆÊûóË≤∑È∫µÂåÖ', loc: 'Bakery Suien' },
                        { time: '12:00', activity: 'Parco City', iconName: 'ShoppingBag', note: 'ÈòøÂç°Â∞á„ÄÅË•øÊùæÂ±ãË£úË≤®', loc: 'SAN-A Urasoe West Coast PARCO CITY' },
                        { time: '13:30', activity: 'oHacort√© Ê∏ØÂ∑ùÂ∫ó', iconName: 'Cake', note: '„ÄêÈáçÈªû„ÄëË∂ÖÁæéÂ§ñ‰∫∫‰ΩèÂÆÖÂçÄÔºå‰∫´Áî®Â§¢ÂπªÊ∞¥ÊûúÂ°î', loc: 'oHacort√© Minatogawa' },
                        { time: '16:00', activity: 'Zhyvago Coffee', iconName: 'Coffee', note: 'ÂõûÁæéÂúãÊùëÔºåÈªûÊùØÂíñÂï°ÁúãÂ§ïÈôΩ', loc: 'ZHYVAGO COFFEE WORKS OKINAWA' },
                        { time: '18:30', activity: 'ÁêâÁêÉ‰πãÁâõ (ÂåóË∞∑Â∫ó)', iconName: 'Utensils', note: '„ÄêÂøÖÂêÉ„ÄëÊ≤ñÁπ©ÁáíËÇâÂ§©Ëä±ÊùøÔºÅÈ†ÇÁ¥öËÇâË≥™ÂÖ•Âè£Âç≥ÂåñÔºåÁµïÂ∞çÈõ£Âøò„ÄÇ', loc: 'Ryukyu no Ushi Chatan' }
                    ]
                },
                day5: {
                    date: '12/27 (‰∫î)',
                    title: 'ÁîüÊó•Âø´Ê®Ç & Ê≠∏ÈÄî',
                    highlight: 'DMM Ê∞¥ÊóèÈ§® & ËòãÊûúÊ¥æ',
                    details: [
                        { time: '08:00', activity: 'ÁîüÊó•Âø´Ê®ÇÔºÅ', iconName: 'Gift', note: 'È£ØÂ∫óÊó©È§êÊÖ∂ÁîüÔºåÊÇ†ÈñíÊï¥ÁêÜË°åÊùé', loc: 'Vessel Hotel Campana Okinawa' },
                        { time: '10:30', activity: 'DMM Ê∞¥ÊóèÈ§® (iias)', iconName: 'Music', note: 'ÊúÄÊñ∞ÁöÑÂΩ±ÂÉèÊ∞¥ÊóèÈ§®ÔºåÂ§¢Âπª‰∏îÈÅ©ÂêàÊãçÁÖß', loc: 'DMM Kariyushi Aquarium' },
                        { time: '13:00', activity: 'Steak House 88', iconName: 'Utensils', note: '„ÄêÂçàÈ§ê„ÄëÊ≤ñÁπ©ËÄÅÁâåÁâõÊéíÈ§®ÔºÅÂ∞±Âú®ÂïÜÂ†¥ÂÖßÔºåÂ§ßÂè£ÂêÉËÇâÊÖ∂ÁîüÔºÅ', loc: 'Steak House 88 iias Okinawa Toyosaki' },
                        { time: '15:30', activity: 'ÁÄ®Èï∑Â≥∂ Umikaji Terrace', iconName: 'Heart', note: '„ÄêÂøÖÂêÉ„ÄëMille Mele ‰∏ñÁïåÁ¨¨‰∏ÄËòãÊûúÊ¥æÔºÅÁúãÈ£õÊ©üËµ∑ÈôçÁöÑÁµïÁæéÊôØÈªû„ÄÇ', loc: 'Senagajima Umikaji Terrace' },
                        { time: '17:00', activity: 'ÈÇÑËªä', iconName: 'Car', note: 'OTS Ëá®Á©∫Ë±êÂ¥éÁáüÊ•≠ÊâÄÈÇÑËªä (Ë®òÂæóÂä†ÊªøÊ≤π)', loc: 'OTS Rent-a-car Rinku Toyosaki' },
                        { time: '19:30', activity: 'È£õÊ©üËµ∑È£õ (CI133)', iconName: 'Plane', note: 'Â∏∂ËëóÊªøÊªøÂõûÊÜ∂ÂõûÂÆ∂', loc: '' }
                    ]
                }
            };
             // Ê∏ÖÂñÆË≥áÊñô
             const initialChecklist = {
                common: { 
                    title: 'ÂÖ±ÂêåÁâ©ÂìÅ', headerColor: 'bg-rose-400', iconName: 'List',
                    items: [ 
                        { text: 'Ë≠∑ÁÖß (ÊúâÊïàÊúü6ÂÄãÊúà‰ª•‰∏ä)', checked: false }, 
                        { text: 'Êó•Âπ£ÁèæÈáë', checked: false }, 
                        { text: '‰ø°Áî®Âç° (JCB‰Ω≥)', checked: false }, 
                        { text: 'Á∂≤Âç°/Êº´ÈÅäË®≠ÂÆö', checked: false }, 
                        { text: 'Ë°åÂãïÈõªÊ∫ê & ÂÖÖÈõªÁ∑ö', checked: false } 
                    ] 
                },
                dad: { 
                    title: 'Áà∏Áà∏ (Âè∏Ê©ü)', headerColor: 'bg-blue-600', iconName: 'Car',
                    items: [ 
                        { text: 'Âè∞ÁÅ£ÈßïÁÖßÊ≠£Êú¨', checked: false }, 
                        { text: 'Êó•ÊñáË≠ØÊú¨ (Áõ£ÁêÜÁ´ôÁî≥Ë´ã)', checked: false }, 
                        { text: 'ÁßüËªäÈ†êÁ¥ÑÁ¢∫Ë™çÂñÆ', checked: false }, 
                        { text: 'ÊâãÊ©üÊû∂ (Â∞éËà™Áî®)', checked: false },
                        { text: 'ÊîùÂΩ±Âô®Êùê/GoPro', checked: false }
                    ] 
                },
                mom: { 
                    title: 'Â™ΩÂ™Ω', headerColor: 'bg-pink-500', iconName: 'Heart',
                    items: [ 
                        { text: 'ÂÄã‰∫∫‰øùÈ§äÂìÅ/ÂåñÂ¶ùÂìÅ', checked: false }, 
                        { text: 'ÈÅÆÈôΩÂ∏Ω/Â§™ÈôΩÁúºÈè°', checked: false }, 
                        { text: 'Èö®Ë∫´Â∞èÂåÖ', checked: false },
                        { text: 'Èõ¢Â≠êÂ§æ/ÈõªÊ£íÊç≤', checked: false }
                    ] 
                },
                child: { 
                    title: 'Â∞èÂ≠©', headerColor: 'bg-orange-400', iconName: 'Baby',
                    items: [ 
                        { text: 'Â∞øÂ∏É (Â§†Áî®Â∞±Â•ΩÔºåÁï∂Âú∞ÂèØË≤∑)', checked: false }, 
                        { text: 'Â•∂Á≤â & Â•∂Áì∂ (Â§öÊäìÂπæÈ§ê‰ªΩÈáè)', checked: false },
                        { text: 'ÊøïÁ¥ôÂ∑æ & Ë°õÁîüÁ¥ô', checked: false }, 
                        { text: 'Áé©ÂÖ∑ & Áπ™Êú¨ (È£õÊ©ü‰∏äÂÆâÊí´Áî®)', checked: false },
                        { text: 'Èò≤ËöäÊ∂≤ & Èò≤Êõ¨‰π≥', checked: false },
                        { text: 'Â∏∏ÂÇôËó•ÂìÅ (ÈÄÄÁáí/ÈÅéÊïè/Â§ñÂÇ∑)', checked: false }, 
                        { text: 'ÂÆâÊí´Áé©ÂÖ∑/Ë¢´Ë¢´', checked: false }, 
                        { text: '‰øùÊ∫´Áì∂ & Ê∞¥Â£∫', checked: false }, 
                        { text: 'ËñÑÂ§ñÂ•ó (ÂÆ§ÂÖßÂÜ∑Ê∞£)', checked: false } 
                    ] 
                },
                other: { 
                    title: 'ÂÖ∂‰ªñ/ÈõúÈ†Ö', headerColor: 'bg-teal-500', iconName: 'ShoppingBag',
                    items: [ 
                        { text: 'Èõ®ÂÇò/Ëºï‰æøÈõ®Ë°£', checked: false }, 
                        { text: 'Áí∞‰øùË≥ºÁâ©Ë¢ã (Â§öÂ∏∂ÂπæÂÄã)', checked: false }, 
                        { text: 'ÊöàËªäËó•/OKÁπÉ', checked: false },
                        { text: 'Á≠Ü (È£õÊ©ü‰∏äÂ°´ÂÖ•Â¢ÉÂç°)', checked: false }
                    ] 
                }
            };

            // Ë°åÂâçÁ¢∫Ë™çÊ∏ÖÂñÆË≥áÊñô
            const initialPreChecklist = {
                documents: {
                    title: 'ÂøÖË¶ÅÊâãÁ∫å/Ë≠â‰ª∂', headerColor: 'bg-indigo-500', iconName: 'ClipboardCheck',
                    items: [
                        { text: 'Visit Japan Web ÁôªÈåÑ', checked: false },
                        { text: 'Ê™¢Êü•Ë≠∑ÁÖßÊïàÊúü (6ÂÄãÊúà‰ª•‰∏ä)', checked: false },
                        { text: 'Ê©üÁ•®ÈõªÂ≠êÊ™î/Á¥ôÊú¨Á¢∫Ë™ç', checked: false },
                        { text: 'È£ØÂ∫óË®ÇÊàøÁ¢∫Ë™çÂñÆ', checked: false }
                    ]
                },
                internet: {
                    title: 'Á∂≤Ë∑Ø/ÈÄöË®ä', headerColor: 'bg-purple-500', iconName: 'Music', // Use Music as placeholder for wifi signal-ish icon or just general
                    items: [
                        { text: 'È†êÁ¥Ñ Wifi Ê©ü / Ë≥ºË≤∑ eSIM', checked: false },
                        { text: 'ÈñãÈÄöÂúãÈöõÊº´ÈÅä (ÂÇôÁî®)', checked: false }
                    ]
                },
                money: {
                    title: 'ÈáëÈå¢/‰øùÈö™', headerColor: 'bg-green-500', iconName: 'ShoppingBag',
                    items: [
                        { text: 'ÂÖåÊèõÊó•Âπ£ÁèæÈáë', checked: false },
                        { text: 'Êäï‰øùÊóÖÈÅäÂπ≥Èö™/‰∏ç‰æøÈö™', checked: false },
                        { text: 'Á¢∫Ë™ç‰ø°Áî®Âç°Êµ∑Â§ñÂõûÈ•ã/È°çÂ∫¶', checked: false }
                    ]
                }
            };

            // ÁãÄÊÖãÁÆ°ÁêÜ - ËÆÄÂèñ LocalStorage Êàñ‰ΩøÁî®È†êË®≠ÂÄº - ‰ΩøÁî® v4 ÈÅøÂÖçË°ùÁ™Å
            const [itinerary, setItinerary] = React.useState(() => {
                const saved = localStorage.getItem('okinawa_itinerary_v2'); // Ë°åÁ®ãÁ∂≠ÊåÅ v2
                return saved ? JSON.parse(saved) : initialItinerary;
            });
            const [checklist, setChecklist] = React.useState(() => {
                const saved = localStorage.getItem('okinawa_checklist_v4'); // Ê∏ÖÂñÆÂçáÁ¥öÁÇ∫ v4
                return saved ? JSON.parse(saved) : initialChecklist;
            });
            const [preChecklist, setPreChecklist] = React.useState(() => {
                const saved = localStorage.getItem('okinawa_prechecklist_v1'); // Ë°åÂâçÊ∏ÖÂñÆ v1
                return saved ? JSON.parse(saved) : initialPreChecklist;
            });

            // Áõ£ËÅΩËÆäÂãï‰∏¶Â≠òÊ™î
            React.useEffect(() => { localStorage.setItem('okinawa_itinerary_v2', JSON.stringify(itinerary)); }, [itinerary]);
            React.useEffect(() => { localStorage.setItem('okinawa_checklist_v4', JSON.stringify(checklist)); }, [checklist]);
            React.useEffect(() => { localStorage.setItem('okinawa_prechecklist_v1', JSON.stringify(preChecklist)); }, [preChecklist]);

            // Checklist Actions
            const toggleChecklistItem = (categoryKey, itemIndex) => {
                setChecklist(prev => {
                    const newItems = [...prev[categoryKey].items];
                    newItems[itemIndex] = { ...newItems[itemIndex], checked: !newItems[itemIndex].checked };
                    return { ...prev, [categoryKey]: { ...prev[categoryKey], items: newItems } };
                });
            };
            const addItem = (category, text) => {
                setChecklist(prev => ({ ...prev, [category]: { ...prev[category], items: [...prev[category].items, { text, checked: false }] } }));
            };
            const deleteItem = (category, index) => {
                setChecklist(prev => {
                    const newItems = prev[category].items.filter((_, i) => i !== index);
                    return { ...prev, [category]: { ...prev[category], items: newItems } };
                });
            };
            const editItem = (category, index, newText) => {
                setChecklist(prev => {
                    const newItems = [...prev[category].items];
                    newItems[index] = { ...newItems[index], text: newText };
                    return { ...prev, [category]: { ...prev[category], items: newItems } };
                });
            };

            // Pre-Checklist Actions
            const togglePreChecklistItem = (categoryKey, itemIndex) => {
                setPreChecklist(prev => {
                    const newItems = [...prev[categoryKey].items];
                    newItems[itemIndex] = { ...newItems[itemIndex], checked: !newItems[itemIndex].checked };
                    return { ...prev, [categoryKey]: { ...prev[categoryKey], items: newItems } };
                });
            };
            const addPreItem = (category, text) => {
                setPreChecklist(prev => ({ ...prev, [category]: { ...prev[category], items: [...prev[category].items, { text, checked: false }] } }));
            };
            const deletePreItem = (category, index) => {
                setPreChecklist(prev => {
                    const newItems = prev[category].items.filter((_, i) => i !== index);
                    return { ...prev, [category]: { ...prev[category], items: newItems } };
                });
            };
            const editPreItem = (category, index, newText) => {
                setPreChecklist(prev => {
                    const newItems = [...prev[category].items];
                    newItems[index] = { ...newItems[index], text: newText };
                    return { ...prev, [category]: { ...prev[category], items: newItems } };
                });
            };

            // Itinerary Actions
            const openMap = (location) => {
                if (!location) return;
                window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location)}`, '_blank');
            };

            const handleDeleteItineraryItem = (dayKey, index) => {
                if(!confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄôÂÄãË°åÁ®ãÂóéÔºü')) return;
                setItinerary(prev => {
                    const newDetails = prev[dayKey].details.filter((_, i) => i !== index);
                    return { ...prev, [dayKey]: { ...prev[dayKey], details: newDetails } };
                });
            };

            const handleSaveItineraryItem = (formData) => {
                setItinerary(prev => {
                    const newDetails = [...prev[modalConfig.dayKey].details];
                    if (modalConfig.isNew) {
                        newDetails.push(formData);
                    } else {
                        newDetails[modalConfig.itemIndex] = formData;
                    }
                    // Á∞°ÂñÆÊéíÂ∫èÔºö‰æùÊôÇÈñì (ÂèØÈÅ∏)
                    newDetails.sort((a, b) => a.time.localeCompare(b.time));
                    return { ...prev, [modalConfig.dayKey]: { ...prev[modalConfig.dayKey], details: newDetails } };
                });
                setModalConfig({ ...modalConfig, isOpen: false });
            };

            if (showIntro) return <WelcomeScreen onStart={() => setShowIntro(false)} />;

            return (
                <div className="min-h-screen pb-20 fade-enter-active max-w-md mx-auto bg-rose-50 shadow-2xl overflow-hidden relative">
                    
                    <header className="safe-top bg-gradient-to-br from-rose-400 via-rose-500 to-pink-600 text-white pt-8 pb-6 px-6 rounded-b-[40px] shadow-lg relative overflow-hidden z-20">
                        <div className="absolute top-0 right-0 opacity-10 transform translate-x-10 -translate-y-10"><Icons.Heart size={180} /></div>
                        <div className="relative z-10 flex justify-between items-start">
                            <div>
                                <h1 className="text-2xl font-bold mb-1 font-cute tracking-wide flex items-center gap-2">Â•≥ÁéãÁöÑÊ≤ñÁπ©ÁîüÊó•‰πãÊóÖ <Icons.Plane size={20} className="animate-pulse" /></h1>
                                <p className="text-rose-100 text-sm font-sans mb-4">12/23 - 12/27 ÔΩú 5 Days 4 Nights</p>
                            </div>
                            {/* Á∑®ËºØÊ®°ÂºèÈñãÈóú */}
                            <button onClick={() => setIsEditMode(!isEditMode)} className={`p-2 rounded-full transition-all ${isEditMode ? 'bg-white text-rose-500 shadow-md rotate-180' : 'bg-white/20 text-white hover:bg-white/30'}`}>
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                            </button>
                        </div>
                    </header>

                    <main className="mt-4 relative z-10 min-h-[calc(100vh-200px)]">
                        {view === 'itinerary' && (
                            <>
                                <div className="sticky top-0 z-20 bg-rose-50/95 backdrop-blur-sm pt-2 pb-4 shadow-sm">
                                    <div className="flex overflow-x-auto px-4 gap-3 no-scrollbar snap-x">
                                        {Object.entries(itinerary).map(([key, day]) => (
                                            <button key={key} onClick={() => setActiveTab(key)} className={`snap-center flex-shrink-0 px-5 py-2 rounded-2xl transition-all shadow-sm border font-cute tracking-wide flex flex-col items-center min-w-[80px] ${activeTab === key ? 'bg-gradient-to-br from-rose-500 to-pink-500 text-white border-transparent shadow-rose-200 shadow-md transform scale-105' : 'bg-white text-gray-500 border-gray-100'}`}>
                                                <span className="text-[10px] opacity-80">{day.date}</span>
                                                <span className="font-bold text-sm">{key === 'day5' ? 'üéÇ ÁîüÊó•' : `Day ${key.replace('day', '')}`}</span>
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                <div className="px-4 animate-fadeIn pb-24 safe-bottom">
                                    <div className="bg-white rounded-[32px] shadow-lg shadow-pink-100 overflow-hidden border border-pink-50">
                                        <div className="bg-gradient-to-r from-rose-50 to-pink-50 p-5 border-b border-rose-100 flex justify-between items-center">
                                            <div>
                                                <h2 className="text-xl font-bold text-gray-800 font-cute flex items-center gap-2">{itinerary[activeTab].title}</h2>
                                                <div className="mt-2 flex items-center gap-1.5 text-rose-600 text-xs font-bold bg-white px-3 py-1 rounded-full w-fit shadow-sm border border-rose-100"><Icons.Star size={12} className="text-rose-500 fill-rose-500" /><span>{itinerary[activeTab].highlight}</span></div>
                                            </div>
                                            {activeTab === 'day5' && <div className="animate-bounce"><Icons.Cake size={32} className="text-rose-400" /></div>}
                                        </div>
                                        
                                        <div className="p-5 space-y-8">
                                            {itinerary[activeTab].details.map((item, index) => {
                                                const ItemIcon = Icons[item.iconName] || Icons.Star;
                                                return (
                                                    <div key={index} className="flex gap-4 relative group">
                                                        {index !== itinerary[activeTab].details.length - 1 && <div className="absolute left-[18px] top-10 bottom-[-32px] w-0.5 bg-gray-100 group-hover:bg-rose-200 transition-colors"></div>}
                                                        <div className="relative z-10 w-10 h-10 rounded-full bg-white border-2 border-pink-100 flex items-center justify-center shadow-sm shrink-0 group-hover:scale-110 group-hover:border-rose-300 transition-all duration-300">
                                                            <ItemIcon size={20} className={item.iconName === 'Heart' ? 'text-rose-500' : 'text-gray-600'} />
                                                        </div>
                                                        <div className="flex-1 pb-2">
                                                            <div className="flex justify-between items-start mb-1">
                                                                <div className="flex items-center gap-2 mb-1">
                                                                    <span className="text-xs font-bold text-rose-500 bg-rose-50 px-2 py-0.5 rounded-md border border-rose-100">{item.time}</span>
                                                                </div>
                                                                <div className="flex gap-2">
                                                                    {isEditMode ? (
                                                                        <>
                                                                            <button onClick={() => setModalConfig({ isOpen: true, isNew: false, dayKey: activeTab, itemIndex: index, item: item })} className="p-1.5 bg-blue-50 text-blue-500 rounded-full hover:bg-blue-100"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg></button>
                                                                            <button onClick={() => handleDeleteItineraryItem(activeTab, index)} className="p-1.5 bg-red-50 text-red-500 rounded-full hover:bg-red-100"><Icons.Trash size={16} /></button>
                                                                        </>
                                                                    ) : (
                                                                        item.loc && <button onClick={() => openMap(item.loc)} className="text-gray-400 hover:text-blue-500 transition-colors"><Icons.Nav size={18} /></button>
                                                                    )}
                                                                </div>
                                                            </div>
                                                            <h3 className="font-bold text-gray-800 text-base mb-1">{item.activity}</h3>
                                                            <p className="text-gray-500 text-sm leading-relaxed font-light">{item.note}</p>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                            {isEditMode && (
                                                <button onClick={() => setModalConfig({ isOpen: true, isNew: true, dayKey: activeTab, itemIndex: null, item: null })} className="w-full py-3 border-2 border-dashed border-rose-200 rounded-xl text-rose-400 font-bold hover:bg-rose-50 transition-colors flex items-center justify-center gap-2">
                                                    <Icons.Plus size={20} /> Êñ∞Â¢ûË°åÁ®ã
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                    <div className="mt-8 text-center opacity-60"><p className="font-script text-2xl text-rose-300">Enjoy your trip</p></div>
                                </div>
                            </>
                        )}
                        
                        {view === 'precheck' && (
                            <ChecklistView title="Ë°åÂâçÁ¢∫Ë™çÈÄ≤Â∫¶" checklist={preChecklist} onToggleItem={togglePreChecklistItem} onAddItem={addPreItem} onDeleteItem={deletePreItem} onEditItem={editPreItem} />
                        )}

                        {view === 'checklist' && (
                            <ChecklistView checklist={checklist} onToggleItem={toggleChecklistItem} onAddItem={addItem} onDeleteItem={deleteItem} onEditItem={editItem} />
                        )}
                    </main>

                    <div className="fixed bottom-6 left-1/2 transform -translate-x-1/2 w-[90%] max-w-[400px] bg-white rounded-full shadow-[0_10px_40px_rgba(0,0,0,0.1)] p-2 flex justify-between items-center z-40 border border-gray-100 safe-bottom">
                        <button onClick={() => setView('itinerary')} className={`flex-1 flex items-center justify-center gap-2 py-3 rounded-full transition-all duration-300 ${view === 'itinerary' ? 'bg-gray-800 text-white shadow-lg' : 'text-gray-400 hover:bg-gray-50'}`}><Icons.Calendar size={20} /><span className="font-bold text-sm">Ë°åÁ®ã</span></button>
                        <button onClick={() => setView('precheck')} className={`flex-1 flex items-center justify-center gap-2 py-3 rounded-full transition-all duration-300 ${view === 'precheck' ? 'bg-indigo-500 text-white shadow-lg shadow-indigo-200' : 'text-gray-400 hover:bg-gray-50'}`}><Icons.ClipboardCheck size={20} /><span className="font-bold text-sm">Ë°åÂâç</span></button>
                        <button onClick={() => setView('checklist')} className={`flex-1 flex items-center justify-center gap-2 py-3 rounded-full transition-all duration-300 ${view === 'checklist' ? 'bg-rose-500 text-white shadow-lg shadow-rose-200' : 'text-gray-400 hover:bg-gray-50'}`}><Icons.CheckSquare size={20} /><span className="font-bold text-sm">Ê∏ÖÂñÆ</span></button>
                    </div>

                    <EditModal isOpen={modalConfig.isOpen} onClose={() => setModalConfig({ ...modalConfig, isOpen: false })} onSave={handleSaveItineraryItem} item={modalConfig.item} isNew={modalConfig.isNew} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ItineraryApp />);
    </script>
</body>
</html>
